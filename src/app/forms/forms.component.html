<section class="send-music-section" id="enviar-musica">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Envie Sua M√∫sica</h2>
      <p class="section-subtitle">
        Preencha os campos abaixo para compartilhar uma m√∫sica especial
      </p>
      <div class="title-underline"></div>
    </div>

    <form class="music-form" #musicForm="ngForm" (ngSubmit)="onSubmit(musicForm)" *ngIf="!enviadoComSucesso">
      <div class="form-group">
        <label class="form-label">Seu nome</label>
        <p class="form-hint">Como voc√™ quer ser identificado</p>
        <input
          type="text"
          class="form-input"
          placeholder="Digite seu nome"
          [(ngModel)]="nomeRemetente"
          name="nomeRemetente"
          required
          minlength="2"
          [disabled]="carregando"
          #nomeInput="ngModel"
        />
        <div *ngIf="nomeInput.invalid && (nomeInput.dirty || nomeInput.touched)" class="error-text">
          <div *ngIf="nomeInput.errors?.['required']">Nome √© obrigat√≥rio</div>
          <div *ngIf="nomeInput.errors?.['minlength']">M√≠nimo 2 caracteres</div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Seu email</label>
        <p class="form-hint">Seu endere√ßo de email</p>
        <input
          type="email"
          class="form-input"
          placeholder="exemplo@gmail.com"
          [(ngModel)]="emailRemetente"
          name="emailRemetente"
          required
          email
          [disabled]="carregando"
          #emailInput="ngModel"
        />
        <div *ngIf="emailInput.invalid && (emailInput.dirty || emailInput.touched)" class="error-text">
          <div *ngIf="emailInput.errors?.['required']">Email √© obrigat√≥rio</div>
          <div *ngIf="emailInput.errors?.['email']">Formato de email inv√°lido</div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Email do destinat√°rio</label>
        <p class="form-hint">Para quem √© essa m√∫sica?</p>
        <input
          type="email"
          class="form-input"
          placeholder="destinatario@gmail.com"
          [(ngModel)]="emailDestinatario"
          name="emailDestinatario"
          required
          email
          [disabled]="carregando"
          #destinatarioInput="ngModel"
        />
        <div *ngIf="destinatarioInput.invalid && (destinatarioInput.dirty || destinatarioInput.touched)" class="error-text">
          <div *ngIf="destinatarioInput.errors?.['required']">Email √© obrigat√≥rio</div>
          <div *ngIf="destinatarioInput.errors?.['email']">Formato de email inv√°lido</div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Mensagem pessoal</label>
        <p class="form-hint">
          O que essa m√∫sica significa para voc√™? Por que escolheu essa m√∫sica para essa pessoa?
        </p>
        <textarea
          class="form-textarea"
          rows="4"
          placeholder="Escreva sua mensagem especial..."
          [(ngModel)]="mensagemPessoal"
          name="mensagemPessoal"
          required
          minlength="10"
          [disabled]="carregando"
          #mensagemInput="ngModel"
        ></textarea>
        <div *ngIf="mensagemInput.invalid && (mensagemInput.dirty || mensagemInput.touched)" class="error-text">
          <div *ngIf="mensagemInput.errors?.['required']">Mensagem √© obrigat√≥ria</div>
          <div *ngIf="mensagemInput.errors?.['minlength']">M√≠nimo 10 caracteres</div>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Pesquisar m√∫sica</label>
        <p class="form-hint">Nome da m√∫sica ou artista</p>
        <div class="search-container">
          <input
            type="text"
            class="form-input search-input"
            placeholder="Ex: 'Divino Maravilhoso - Gal Costa'"
            [(ngModel)]="busca"
            (input)="buscarSugestoes()"
            name="busca"
            [disabled]="carregando"
          />
          <button 
            type="button" 
            class="search-button" 
            (click)="buscarSugestoes()"
            [disabled]="carregando"
          >
            Buscar
          </button>
        </div>

        <ul *ngIf="sugestoes.length > 0" class="sugestoes-list">
          <li *ngFor="let s of sugestoes" (click)="selecionarMusica(s)">
            <span class="music-icon">üéµ</span>
            <div class="music-info">
              <div class="music-name">{{ s.nome }}</div>
              <div class="music-artist">{{ s.artista }}</div>
            </div>
          </li>
        </ul>

        <div *ngIf="nomeMusica" class="musica-selecionada">
          <p><strong>M√∫sica selecionada:</strong></p>
          <p>{{ nomeMusica }} - {{ artista }}</p>
          <a [href]="linkSpotify" target="_blank">Ouvir no Spotify ‚Üí</a>
        </div>
        <div *ngIf="!nomeMusica && musicForm.submitted" class="error-text">
          Por favor, selecione uma m√∫sica
        </div>
      </div>

      <div *ngIf="erroEnvio" class="error-message">
        <i class="fas fa-exclamation-circle"></i>
        <p>{{ erroEnvio }}</p>
      </div>

      <div *ngIf="carregando" class="loading-message">
        <div class="spinner"></div>
        <p>Enviando sua m√∫sica...</p>
      </div>

      <button 
        type="submit" 
        class="submit-button" 
        [disabled]="carregando || musicForm.invalid || !nomeMusica"
      >
        <span *ngIf="!carregando">Enviar M√∫sica</span>
        <span *ngIf="carregando">Enviando...</span>
      </button>
    </form>

    <div *ngIf="enviadoComSucesso" class="success-message">
      <i class="fas fa-check-circle"></i>
      <h3>Sua m√∫sica foi enviada com sucesso!</h3>
      <p>A mensagem musical est√° a caminho do destinat√°rio.</p>
      <button (click)="resetarFormulario(); enviadoComSucesso = false" class="new-submission-btn">
        Enviar outra m√∫sica
      </button>
    </div>
  </div>
</section>
